{"ast":null,"code":"var _jsxFileName = \"/Users/isracarballo/Desktop/DEV REPO/Promotions/client/src/components/Promociones/Edit/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form, Tabs, Spin, message } from \"antd\";\nimport { CheckOutlined, ControlOutlined, UploadOutlined } from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport GeneralForm from \"./GeneralForm\";\nimport SubidaImagenForm from \"./SubidaImagenForm\";\nimport Confirmacion from \"./Confirmacion\";\nimport { put_promotion_data, save_confirmacion_info, save_general_info } from \"../../../actions/promotion\";\nimport { EditValuesForm } from \"../../../helpers/Estados/Edit\";\nimport { assignSameHotSaleAlert } from \"../../../helpers/Estados/assignHotSaleEdit\";\n\nconst PromocionesEdicion = ({\n  dataUpdate,\n  handleOnCloseDrawer\n}) => {\n  const dispatch = useDispatch();\n  const {\n    allPromotion,\n    generalInfo,\n    subidaImagenInfo,\n    actionSuccess\n  } = useSelector(({\n    promotions\n  }) => promotions);\n  const {\n    TabPane\n  } = Tabs;\n  let isUpload = true;\n  let isAssignHotSale = false;\n  let resultCompleteForm = null;\n  const [tabIndex, setTabIndex] = useState(\"0\");\n  const [loading, setLoading] = useState(false);\n  const [loadingRequestForm, setLoadingRequestForm] = useState(false);\n  const [isRequiredFecha, setIsRequiredFecha] = useState(true);\n  const [formIsComplete, setFormIsComplete] = useState(false);\n  var assignNegocioResult = {\n    equalsNegocio: false,\n    negocio: null\n  };\n  const [enabledTabs, setEnabledTabs] = useState({\n    general: false,\n    hotSale: true,\n    subidaImagen: true,\n    confirmacion: true\n  });\n  useEffect(() => {\n    if (allPromotion != null) {\n      setLoading(false);\n    } else {\n      setLoading(true);\n    }\n\n    generalInfo !== null && setEnabledTabs({\n      hotSale: false,\n      subidaImagen: false,\n      confirmacion: true\n    });\n\n    if (formIsComplete) {\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: false\n      });\n    }\n\n    if (actionSuccess) {\n      setTabIndex(\"2\");\n    }\n  }, [allPromotion, generalInfo, formIsComplete, actionSuccess]);\n\n  const handleTabPanel = index => {\n    setTabIndex(index);\n  };\n\n  const changeNegocio = negocio => {\n    const {\n      isEqualsNegocio,\n      negocioResult\n    } = assignSameHotSaleAlert(allPromotion, dataUpdate, negocio);\n    assignNegocioResult.equalsNegocio = isEqualsNegocio;\n    assignNegocioResult.negocio = negocioResult;\n\n    if (assignNegocioResult.equalsNegocio) {\n      showIsEqualsNegocio();\n    } else {\n      isAssignHotSale = false;\n    }\n  };\n\n  const showIsEqualsNegocio = () => message.warning(`No se puede asignar mas de un \"HOT SALE\" para el negocio ${assignNegocioResult.negocio}`);\n\n  const onFinishGeneral = values => {\n    try {\n      if (values.fechaIF[0] !== null && values.fechaIF[1] !== null) {\n        if (assignNegocioResult.equalsNegocio) {\n          showIsEqualsNegocio();\n          return;\n        } else {\n          values.fechaIF = {\n            inicio: moment(values.fechaIF[0]).format(),\n            expiracion: moment(values.fechaIF[1]).format()\n          };\n          setTabIndex(\"1\");\n          dispatch(save_general_info(values));\n        }\n      } else {\n        setIsRequiredFecha(true);\n      }\n    } catch (error) {\n      message.error('No se pudo realizar la alta de \"General\" correctamente');\n    }\n  };\n\n  const onFinishSubidaImagen = (_, img, newEdit) => {\n    console.log(subidaImagenInfo);\n\n    try {\n      if (img.fileList !== undefined && img.fileList.length === 0) {\n        message.warning(\"Debe seleccionar una imagen\");\n      } else if (img.fileList !== undefined && img.fileList.length > 1) {\n        message.info(\"Solo esta permitido cargar una foto\");\n        return;\n      } else if (subidaImagenInfo !== null || newEdit !== null && newEdit.imgData !== null && newEdit.type !== null) {\n        isUpload = false;\n        setFormIsComplete(true);\n        resultCompleteForm = EditValuesForm(dataUpdate, generalInfo, subidaImagenInfo || newEdit);\n        resultCompleteForm !== null && dispatch(put_promotion_data(resultCompleteForm));\n      }\n    } catch (error) {\n      message.error(\"No se pudo completar el alta correctamente\");\n    }\n  };\n\n  const onFinishConfirmacion = values => {\n    setLoadingRequestForm(true);\n    dispatch(save_confirmacion_info(values));\n    setEnabledTabs(...enabledTabs);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: dataUpdate === undefined ? \"bg-white m-4 shadow p-5\" : \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Spin, {\n    tip: \"Cargando...\",\n    style: {\n      height: \"100vh\"\n    },\n    spinning: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    activeKey: tabIndex,\n    onChange: handleTabPanel,\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 17\n      }\n    }), \"Configuraci\\xF3n\"),\n    disabled: enabledTabs.general,\n    key: \"0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(GeneralForm, {\n    changeNegocio: changeNegocio,\n    dataUpdate: dataUpdate,\n    onFinish: onFinishGeneral,\n    isRequiredFecha: isRequiredFecha,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(UploadOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 17\n      }\n    }), \"Subida de Imagen\"),\n    disabled: enabledTabs.subidaImagen,\n    key: \"1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(SubidaImagenForm, {\n    onFinish: onFinishSubidaImagen,\n    dataUpdate: dataUpdate,\n    loading: loadingRequestForm,\n    imgPromoIsUpload: isUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(CheckOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }\n    }), \"Confirmaci\\xF3n\"),\n    disabled: enabledTabs.confirmacion,\n    key: \"2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    layout: \"vertical\",\n    hideRequiredMark: true,\n    className: \"pt-3\",\n    onFinish: onFinishConfirmacion,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Confirmacion, {\n    loading: false,\n    isEdit: false,\n    handleOnCloseDrawer: handleOnCloseDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 15\n    }\n  }))))));\n};\n\nexport default PromocionesEdicion;","map":{"version":3,"sources":["/Users/isracarballo/Desktop/DEV REPO/Promotions/client/src/components/Promociones/Edit/index.js"],"names":["React","useEffect","useState","useDispatch","useSelector","Form","Tabs","Spin","message","CheckOutlined","ControlOutlined","UploadOutlined","moment","GeneralForm","SubidaImagenForm","Confirmacion","put_promotion_data","save_confirmacion_info","save_general_info","EditValuesForm","assignSameHotSaleAlert","PromocionesEdicion","dataUpdate","handleOnCloseDrawer","dispatch","allPromotion","generalInfo","subidaImagenInfo","actionSuccess","promotions","TabPane","isUpload","isAssignHotSale","resultCompleteForm","tabIndex","setTabIndex","loading","setLoading","loadingRequestForm","setLoadingRequestForm","isRequiredFecha","setIsRequiredFecha","formIsComplete","setFormIsComplete","assignNegocioResult","equalsNegocio","negocio","enabledTabs","setEnabledTabs","general","hotSale","subidaImagen","confirmacion","handleTabPanel","index","changeNegocio","isEqualsNegocio","negocioResult","showIsEqualsNegocio","warning","onFinishGeneral","values","fechaIF","inicio","format","expiracion","error","onFinishSubidaImagen","_","img","newEdit","console","log","fileList","undefined","length","info","imgData","type","onFinishConfirmacion","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form, Tabs, Spin, message } from \"antd\";\nimport {\n  CheckOutlined,\n  ControlOutlined,\n  UploadOutlined,\n} from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport GeneralForm from \"./GeneralForm\";\nimport SubidaImagenForm from \"./SubidaImagenForm\";\nimport Confirmacion from \"./Confirmacion\";\nimport {\n  put_promotion_data,\n  save_confirmacion_info,\n  save_general_info,\n} from \"../../../actions/promotion\";\nimport { EditValuesForm } from \"../../../helpers/Estados/Edit\";\nimport { assignSameHotSaleAlert } from \"../../../helpers/Estados/assignHotSaleEdit\";\nconst PromocionesEdicion = ({ dataUpdate, handleOnCloseDrawer }) => {\n  const dispatch = useDispatch();\n  const {\n    allPromotion,\n    generalInfo,\n    subidaImagenInfo,\n    actionSuccess,\n  } = useSelector(({ promotions }) => promotions);\n\n  const { TabPane } = Tabs;\n  let isUpload = true;\n  let isAssignHotSale = false;\n  let resultCompleteForm = null;\n  const [tabIndex, setTabIndex] = useState(\"0\");\n  const [loading, setLoading] = useState(false);\n  const [loadingRequestForm, setLoadingRequestForm] = useState(false);\n  const [isRequiredFecha, setIsRequiredFecha] = useState(true);\n  const [formIsComplete, setFormIsComplete] = useState(false);\n\n  var assignNegocioResult = {\n    equalsNegocio: false,\n    negocio: null,\n  };\n  \n  const [enabledTabs, setEnabledTabs] = useState({\n    general: false,\n    hotSale: true,\n    subidaImagen: true,\n    confirmacion: true,\n  });\n\n  useEffect(() => {\n    if (allPromotion != null) {\n      setLoading(false);\n    } else {\n      setLoading(true);\n    }\n    generalInfo !== null &&\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: true,\n      });\n    if (formIsComplete) {\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: false,\n      });\n    }\n    if (actionSuccess) {\n      setTabIndex(\"2\");\n    }\n  }, [allPromotion, generalInfo, formIsComplete, actionSuccess]);\n\n  const handleTabPanel = (index) => {\n    setTabIndex(index);\n  };\n\n  const changeNegocio = (negocio) => {\n    const { isEqualsNegocio, negocioResult } = assignSameHotSaleAlert(\n      allPromotion,\n      dataUpdate,\n      negocio\n    );\n    assignNegocioResult.equalsNegocio = isEqualsNegocio;\n    assignNegocioResult.negocio = negocioResult;\n\n    if (assignNegocioResult.equalsNegocio) {\n      showIsEqualsNegocio();\n    } else {\n      isAssignHotSale = false;\n    }\n  };\n\n  const showIsEqualsNegocio = () =>\n    message.warning(\n      `No se puede asignar mas de un \"HOT SALE\" para el negocio ${assignNegocioResult.negocio}`\n    );\n\n  const onFinishGeneral = (values) => {\n    try {\n      if (values.fechaIF[0] !== null && values.fechaIF[1] !== null) {\n        if (assignNegocioResult.equalsNegocio) {\n          showIsEqualsNegocio();\n          return;\n        } else {\n          values.fechaIF = {\n            inicio: moment(values.fechaIF[0]).format(),\n            expiracion: moment(values.fechaIF[1]).format(),\n          };\n          setTabIndex(\"1\");\n          dispatch(save_general_info(values));\n        }\n      } else {\n        setIsRequiredFecha(true);\n      }\n    } catch (error) {\n      message.error('No se pudo realizar la alta de \"General\" correctamente');\n    }\n  };\n\n  const onFinishSubidaImagen = (_, img, newEdit) => {\n    console.log(subidaImagenInfo);\n    try {\n      if (img.fileList !== undefined && img.fileList.length === 0) {\n        message.warning(\"Debe seleccionar una imagen\");\n      } else if (img.fileList !== undefined && img.fileList.length > 1) {\n        message.info(\"Solo esta permitido cargar una foto\");\n        return;\n      } else if (\n        subidaImagenInfo !== null ||\n        (newEdit !== null && newEdit.imgData !== null && newEdit.type !== null)\n      ) {\n        isUpload = false;\n        setFormIsComplete(true);\n        resultCompleteForm = EditValuesForm(\n          dataUpdate,\n          generalInfo,\n          subidaImagenInfo || newEdit\n        );\n\n        resultCompleteForm !== null &&\n          dispatch(put_promotion_data(resultCompleteForm));\n      }\n    } catch (error) {\n      message.error(\"No se pudo completar el alta correctamente\");\n    }\n  };\n\n  const onFinishConfirmacion = (values) => {\n    setLoadingRequestForm(true);\n    dispatch(save_confirmacion_info(values));\n    setEnabledTabs(...enabledTabs);\n  };\n\n  return (\n    <div className={dataUpdate === undefined ? \"bg-white m-4 shadow p-5\" : \"\"}>\n      <Spin tip=\"Cargando...\" style={{ height: \"100vh\" }} spinning={loading}>\n        <Tabs activeKey={tabIndex} onChange={handleTabPanel} centered>\n          <TabPane\n            tab={\n              <span>\n                <ControlOutlined />\n                Configuraci&oacute;n\n              </span>\n            }\n            disabled={enabledTabs.general}\n            key={\"0\"}\n          >\n            <GeneralForm\n              changeNegocio={changeNegocio}\n              dataUpdate={dataUpdate}\n              onFinish={onFinishGeneral}\n              isRequiredFecha={isRequiredFecha}\n            />\n          </TabPane>\n          <TabPane\n            tab={\n              <span>\n                <UploadOutlined />\n                Subida de Imagen\n              </span>\n            }\n            disabled={enabledTabs.subidaImagen}\n            key={\"1\"}\n          >\n            <SubidaImagenForm\n              onFinish={onFinishSubidaImagen}\n              dataUpdate={dataUpdate}\n              loading={loadingRequestForm}\n              imgPromoIsUpload={isUpload}\n            />\n          </TabPane>\n          <TabPane\n            tab={\n              <span>\n                <CheckOutlined />\n                Confirmaci&oacute;n\n              </span>\n            }\n            disabled={enabledTabs.confirmacion}\n            key={\"2\"}\n          >\n            <Form\n              layout=\"vertical\"\n              hideRequiredMark\n              className=\"pt-3\"\n              onFinish={onFinishConfirmacion}\n            >\n              <Confirmacion\n                loading={false}\n                isEdit={false}\n                handleOnCloseDrawer={handleOnCloseDrawer}\n              />\n            </Form>\n          </TabPane>\n        </Tabs>\n      </Spin>\n    </div>\n  );\n};\nexport default PromocionesEdicion;\n"]},"metadata":{},"sourceType":"module"}