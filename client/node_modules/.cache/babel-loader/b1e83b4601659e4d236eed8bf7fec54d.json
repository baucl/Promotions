{"ast":null,"code":"var _jsxFileName = \"/Users/isracarballo/Desktop/DEV REPO/Promotion-master/client/src/app/dashboard/Promociones/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form, Tabs, Spin, message } from \"antd\";\nimport { CheckOutlined, ControlOutlined, UploadOutlined } from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport GeneralForm from \"../../../components/Promociones/New/GeneralForm\";\nimport SubidaImagenForm from \"../../../components/Promociones/New/SubidaImagenForm\";\nimport Confirmacion from \"../../../components/Promociones/New/Confirmacion\";\nimport { create_a_new_promotion, save_confirmacion_info, save_general_info } from \"../../../actions/promotion\";\nimport { objPromotion } from \"../../../helpers/promotionObj\";\n\nconst Promociones = ({\n  dataUpdate,\n  handleOnCloseDrawer\n}) => {\n  const dispatch = useDispatch();\n  const {\n    allPromotion,\n    generalInfo,\n    subidaImagenInfo,\n    actionSuccess\n  } = useSelector(({\n    promotions\n  }) => promotions);\n  const {\n    TabPane\n  } = Tabs;\n  let isUpload = true;\n  let resultCompleteForm = null;\n  const [tabIndex, setTabIndex] = useState(\"0\");\n  const [check, setCheck] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingRequestForm, setLoadingRequestForm] = useState(false);\n  const [isRequiredFecha, setIsRequiredFecha] = useState(true);\n  const [formIsComplete, setFormIsComplete] = useState(false);\n  const [datePickerInfo, setDatePickerInfo] = useState({\n    ini: null,\n    end: null\n  });\n  const [enabledTabs, setEnabledTabs] = useState({\n    general: false,\n    hotSale: true,\n    subidaImagen: true,\n    confirmacion: true\n  });\n  useEffect(() => {\n    if (allPromotion != null) {\n      setLoading(false);\n    } else {\n      setLoading(true);\n    }\n\n    generalInfo !== null && setEnabledTabs({\n      hotSale: false,\n      subidaImagen: false,\n      confirmacion: true\n    });\n\n    if (formIsComplete) {\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: false\n      });\n    }\n\n    if (actionSuccess) {\n      setTabIndex(\"2\");\n    }\n  }, [allPromotion, generalInfo, formIsComplete, actionSuccess]);\n\n  const handleTabPanel = index => {\n    setTabIndex(index);\n  };\n\n  const onChange = checked => setCheck(checked);\n\n  const onFinishGeneral = values => {\n    try {\n      if (datePickerInfo.ini !== null && datePickerInfo.end !== null) {\n        values.fechaIF = {\n          [\"inicio\"]: datePickerInfo.ini,\n          [\"expiracion\"]: datePickerInfo.end\n        };\n        values[\"Visible\"] = check;\n        setTabIndex(\"1\");\n        dispatch(save_general_info(values));\n      } else {\n        setIsRequiredFecha(true);\n      }\n    } catch (error) {\n      message.error('No se pudo realizar la alta de \"General\" correctamente');\n    }\n  };\n\n  const onFinishSubidaImagen = (_, img) => {\n    try {\n      if (img.fileList !== undefined && img.fileList.length === 0) {\n        message.warning(\"Debe seleccionar una imagen\");\n      } else if (img.fileList !== undefined && img.fileList.length > 1) {\n        message.info(\"Solo esta permitido cargar una foto\");\n        return;\n      } else {\n        isUpload = false;\n        setFormIsComplete(true);\n        resultCompleteForm = objPromotion(allPromotion, generalInfo, subidaImagenInfo);\n        resultCompleteForm !== null && dispatch(create_a_new_promotion(resultCompleteForm));\n      }\n    } catch (error) {\n      message.error(\"No se pudo completar el alta correctamente\");\n    }\n  };\n\n  const onFinishConfirmacion = values => {\n    setLoadingRequestForm(true);\n    dispatch(save_confirmacion_info(values));\n    setEnabledTabs(...enabledTabs);\n  };\n\n  const hanleChangeDatePicker = (_, newDate) => {\n    if (newDate !== null && Array.isArray(newDate) && newDate) {\n      setDatePickerInfo({\n        ini: moment(newDate[0]).format(),\n        end: moment(newDate[1]).format()\n      });\n      setIsRequiredFecha(false);\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: dataUpdate === undefined ? \"bg-white m-4 shadow p-5\" : \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Spin, {\n    tip: \"Cargando...\",\n    style: {\n      height: \"100vh\"\n    },\n    spinning: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    activeKey: tabIndex,\n    onChange: handleTabPanel,\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }\n    }), \"Configuraci\\xF3n\"),\n    disabled: enabledTabs.general,\n    key: \"0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(GeneralForm, {\n    dataUpdate: dataUpdate,\n    onChange: onChange,\n    hanleChangeDatePicker: hanleChangeDatePicker,\n    onFinish: onFinishGeneral,\n    datePickerInfoIni: datePickerInfo.ini,\n    datePickerInfoEnd: datePickerInfo.end,\n    check: check,\n    isRequiredFecha: isRequiredFecha,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(UploadOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }\n    }), \"Subida de Imagen\"),\n    disabled: enabledTabs.subidaImagen,\n    key: \"1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(SubidaImagenForm, {\n    onFinish: onFinishSubidaImagen,\n    dataUpdate: dataUpdate,\n    loading: loadingRequestForm,\n    imgPromoIsUpload: isUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(TabPane, {\n    tab: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(CheckOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }), \"Confirmaci\\xF3n\"),\n    disabled: enabledTabs.confirmacion,\n    key: \"2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    layout: \"vertical\",\n    hideRequiredMark: true,\n    className: \"pt-3\",\n    onFinish: onFinishConfirmacion,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Confirmacion, {\n    loading: false,\n    isEdit: false,\n    handleOnCloseDrawer: handleOnCloseDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 15\n    }\n  }))))));\n};\n\nexport default Promociones;","map":{"version":3,"sources":["/Users/isracarballo/Desktop/DEV REPO/Promotion-master/client/src/app/dashboard/Promociones/index.js"],"names":["React","useEffect","useState","useDispatch","useSelector","Form","Tabs","Spin","message","CheckOutlined","ControlOutlined","UploadOutlined","moment","GeneralForm","SubidaImagenForm","Confirmacion","create_a_new_promotion","save_confirmacion_info","save_general_info","objPromotion","Promociones","dataUpdate","handleOnCloseDrawer","dispatch","allPromotion","generalInfo","subidaImagenInfo","actionSuccess","promotions","TabPane","isUpload","resultCompleteForm","tabIndex","setTabIndex","check","setCheck","loading","setLoading","loadingRequestForm","setLoadingRequestForm","isRequiredFecha","setIsRequiredFecha","formIsComplete","setFormIsComplete","datePickerInfo","setDatePickerInfo","ini","end","enabledTabs","setEnabledTabs","general","hotSale","subidaImagen","confirmacion","handleTabPanel","index","onChange","checked","onFinishGeneral","values","fechaIF","error","onFinishSubidaImagen","_","img","fileList","undefined","length","warning","info","onFinishConfirmacion","hanleChangeDatePicker","newDate","Array","isArray","format","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Form, Tabs, Spin, message } from \"antd\";\nimport {\n  CheckOutlined,\n  ControlOutlined,\n  UploadOutlined,\n} from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport GeneralForm from \"../../../components/Promociones/New/GeneralForm\";\nimport SubidaImagenForm from \"../../../components/Promociones/New/SubidaImagenForm\";\nimport Confirmacion from \"../../../components/Promociones/New/Confirmacion\";\nimport {\n  create_a_new_promotion,\n  save_confirmacion_info,\n  save_general_info,\n} from \"../../../actions/promotion\";\nimport { objPromotion } from \"../../../helpers/promotionObj\";\nconst Promociones = ({ dataUpdate, handleOnCloseDrawer }) => {\n  const dispatch = useDispatch();\n  const {\n    allPromotion,\n    generalInfo,\n    subidaImagenInfo,\n    actionSuccess,\n  } = useSelector(({ promotions }) => promotions);\n  const { TabPane } = Tabs;\n  let isUpload = true;\n  let resultCompleteForm = null;\n  const [tabIndex, setTabIndex] = useState(\"0\");\n  const [check, setCheck] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingRequestForm, setLoadingRequestForm] = useState(false);\n  const [isRequiredFecha, setIsRequiredFecha] = useState(true);\n  const [formIsComplete, setFormIsComplete] = useState(false);\n  const [datePickerInfo, setDatePickerInfo] = useState({\n    ini: null,\n    end: null,\n  });\n  const [enabledTabs, setEnabledTabs] = useState({\n    general: false,\n    hotSale: true,\n    subidaImagen: true,\n    confirmacion: true,\n  });\n\n  useEffect(() => {\n    if (allPromotion != null) {\n      setLoading(false);\n    } else {\n      setLoading(true);\n    }\n    generalInfo !== null &&\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: true,\n      });\n    if (formIsComplete) {\n      setEnabledTabs({\n        hotSale: false,\n        subidaImagen: false,\n        confirmacion: false,\n      });\n    }\n    if (actionSuccess) {\n      setTabIndex(\"2\");\n    }\n  }, [allPromotion, generalInfo, formIsComplete, actionSuccess]);\n\n  const handleTabPanel = (index) => {\n    setTabIndex(index);\n  };\n\n  const onChange = (checked) => setCheck(checked);\n\n  const onFinishGeneral = (values) => {\n    try {\n      if (datePickerInfo.ini !== null && datePickerInfo.end !== null) {\n        values.fechaIF = {\n          [\"inicio\"]: datePickerInfo.ini,\n          [\"expiracion\"]: datePickerInfo.end,\n        };\n        values[\"Visible\"] = check;\n        setTabIndex(\"1\");\n        dispatch(save_general_info(values));\n      } else {\n        setIsRequiredFecha(true);\n      }\n    } catch (error) {\n      message.error('No se pudo realizar la alta de \"General\" correctamente');\n    }\n  };\n\n  const onFinishSubidaImagen = (_, img) => {\n    try {\n      if (img.fileList !== undefined && img.fileList.length === 0) {\n        message.warning(\"Debe seleccionar una imagen\");\n      } else if (img.fileList !== undefined && img.fileList.length > 1) {\n        message.info(\"Solo esta permitido cargar una foto\");\n        return;\n      } else {\n        isUpload = false;\n        setFormIsComplete(true);\n        resultCompleteForm = objPromotion(\n          allPromotion,\n          generalInfo,\n          subidaImagenInfo\n        );\n        resultCompleteForm !== null &&\n          dispatch(create_a_new_promotion(resultCompleteForm));\n      }\n    } catch (error) {\n      message.error(\"No se pudo completar el alta correctamente\");\n    }\n  };\n\n  const onFinishConfirmacion = (values) => {\n    setLoadingRequestForm(true);\n    dispatch(save_confirmacion_info(values));\n    setEnabledTabs(...enabledTabs);\n  };\n\n  const hanleChangeDatePicker = (_, newDate) => {\n    if (newDate !== null && Array.isArray(newDate) && newDate) {\n      setDatePickerInfo({\n        ini: moment(newDate[0]).format(),\n        end: moment(newDate[1]).format(),\n      });\n      setIsRequiredFecha(false);\n    }\n  };\n\n  return (\n    <div className={dataUpdate === undefined ? \"bg-white m-4 shadow p-5\" : \"\"}>\n      <Spin tip=\"Cargando...\" style={{ height: \"100vh\" }} spinning={loading}>\n        <Tabs activeKey={tabIndex} onChange={handleTabPanel} centered>\n          <TabPane\n            tab={\n              <span>\n                <ControlOutlined />\n                Configuraci&oacute;n\n              </span>\n            }\n            disabled={enabledTabs.general}\n            key={\"0\"}\n          >\n            <GeneralForm\n              dataUpdate={dataUpdate}\n              onChange={onChange}\n              hanleChangeDatePicker={hanleChangeDatePicker}\n              onFinish={onFinishGeneral}\n              datePickerInfoIni={datePickerInfo.ini}\n              datePickerInfoEnd={datePickerInfo.end}\n              check={check}\n              isRequiredFecha={isRequiredFecha}\n            />\n          </TabPane>\n          <TabPane\n            tab={\n              <span>\n                <UploadOutlined />\n                Subida de Imagen\n              </span>\n            }\n            disabled={enabledTabs.subidaImagen}\n            key={\"1\"}\n          >\n            <SubidaImagenForm\n              onFinish={onFinishSubidaImagen}\n              dataUpdate={dataUpdate}\n              loading={loadingRequestForm}\n              imgPromoIsUpload={isUpload}\n            />\n          </TabPane>\n          <TabPane\n            tab={\n              <span>\n                <CheckOutlined />\n                Confirmaci&oacute;n\n              </span>\n            }\n            disabled={enabledTabs.confirmacion}\n            key={\"2\"}\n          >\n            <Form\n              layout=\"vertical\"\n              hideRequiredMark\n              className=\"pt-3\"\n              onFinish={onFinishConfirmacion}\n            >\n              <Confirmacion\n                loading={false}\n                isEdit={false}\n                handleOnCloseDrawer={handleOnCloseDrawer}\n              />\n            </Form>\n          </TabPane>\n        </Tabs>\n      </Spin>\n    </div>\n  );\n};\nexport default Promociones;\n"]},"metadata":{},"sourceType":"module"}